<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/favicon-180x180.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/xml; charset=utf-8" x-content-type="nosniff" title="Pro Coder" href="https://dev.procoder.io/rss.xml"><link rel="canonical" href="https://dev.procoder.io/articles/medium/2022-06-08_how-i-stopped-worrying-and-learned-to-love-regular-expressions-40fd12400bf0/"><meta name="generator" content="Astro v5.7.9"><title>How I stopped worrying and learned to love regular expressions | Pro Coder</title><!-- Google tag (gtag.js) @formatter:off --><script async src="https://www.googletagmanager.com/gtag/js?id=G-8W1YK6K7NM"></script> <script type="module">const a={measurementId:"G-8W1YK6K7NM"};window.dataLayer=window.dataLayer||[];window.gtag=function(){dataLayer.push(arguments)};window.gtag("js",new Date);window.gtag("config",a.measurementId);</script> <!-- Google tag (gtag.js) @formatter:on --><meta name="description" content="As mentioned in my previous article, people select relational over NoSQL databases for new projects. Big time. We’re talking 80% of the…"><meta name="robots" content="index, follow"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"><!-- Open Graph --><meta property="og:type" content="website"><meta property="og:url" content="https://dev.procoder.io/articles/medium/2022-06-08_how-i-stopped-worrying-and-learned-to-love-regular-expressions-40fd12400bf0/"><meta property="og:title" content="How I stopped worrying and learned to love regular expressions | Pro Coder"><meta property="og:description" content="As mentioned in my previous article, people select relational over NoSQL databases for new projects. Big time. We’re talking 80% of the…"><meta property="og:image" content="https://dev.procoder.io/_astro/1_zrjjtCTZQSbnZXiMSrHJng.On3C6N9Z.jpeg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://dev.procoder.io/articles/medium/2022-06-08_how-i-stopped-worrying-and-learned-to-love-regular-expressions-40fd12400bf0/"><meta property="twitter:title" content="How I stopped worrying and learned to love regular expressions | Pro Coder"><meta property="twitter:description" content="As mentioned in my previous article, people select relational over NoSQL databases for new projects. Big time. We’re talking 80% of the…"><meta property="twitter:image" content="https://dev.procoder.io/_astro/1_zrjjtCTZQSbnZXiMSrHJng.On3C6N9Z.jpeg"><link rel="stylesheet" href="/_astro/_page_.73rjLEl_.css"></head> <body data-theme="procoder"> <header class="fixed top-0 z-50 w-full left-0"> <div class="site-container mx-auto px-4 mt-4"> <div class="flex justify-between items-center gap-4 bg-primary/90 py-2 lg:py-4 rounded-lg px-4 border-black border"> <a href="/" class="logo uppercase font-logo transition-colors duration-200 font-light text-header-logo hover:text-primary">  <img src="/_astro/ProCoderLogo_white.DI51sbMv_Z1hejQB.webp" alt width="1800" height="1800" loading="lazy" decoding="async" class="w-16 h-auto">  </a> <nav class="relative flex items-center gap-2 lg:gap-8" aria-label="Site Navigation"> <!-- Desktop Menu --> <ul class="hidden lg:flex lg:gap-8 items-center"> <li class="relative group"> <div class="flex items-center gap-1"> <a href="/" class="text-small font-medium uppercase rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-nav-text-active text-nav-text hover:text-nav-text-hover"> Home  </a> </div>  </li><li class="relative group"> <div class="flex items-center gap-1"> <a href="/bio" class="text-small font-medium uppercase rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-nav-text-active text-nav-text hover:text-nav-text-hover"> About Greg  </a> </div>  </li><li class="relative group"> <div class="flex items-center gap-1"> <a href="https://procoder.myspreadshop.com" class="text-small font-medium uppercase rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-nav-text-active text-nav-text hover:text-nav-text-hover"> Merch  </a> </div>  </li> </ul> <!-- CartButton is after desktop menus, but before the hamburger icon --> <a href="/checkout" class="flex items-center gap-2 text-background px-4 py-2 transition " id="cart-button"> <div class="relative text-secondary"> <svg xmlns="http://www.w3.org/2000/svg" stroke-width="2" width="28" height="28" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" fill="none" viewBox="0 0 24 24" class="lucide lucide-shopping-cart">  <circle cx="8" cy="21" r="1"></circle> <circle cx="19" cy="21" r="1"></circle> <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>  </svg> <span id="cart-count" class="absolute top-[-5px] right-[-10px] bg-secondary text-background-dark text-xs rounded-full w-5 h-5 flex items-center justify-center">
0
</span> </div> <script type="module" src="/_astro/CartButton.astro_astro_type_script_index_0_lang.D2KgPWt2.js"></script> </a> <!-- Mobile Menu Button --> <button class="mobile-menu-button relative z-30 p-2 border-none cursor-pointer bg-transparent lg:hidden" aria-label="Toggle Menu" aria-expanded="false"> <span class="menu-icon block"> <svg xmlns="http://www.w3.org/2000/svg" stroke-width="2" width="24" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" fill="none" viewBox="0 0 24 24" class="lucide lucide-menu text-nav-mobile-text">  <line x1="4" x2="20" y1="12" y2="12"></line> <line x1="4" x2="20" y1="6" y2="6"></line> <line x1="4" x2="20" y1="18" y2="18"></line>  </svg> </span> <span class="close-icon hidden"> <svg xmlns="http://www.w3.org/2000/svg" stroke-width="2" width="24" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" fill="none" viewBox="0 0 24 24" class="lucide lucide-x text-nav-mobile-text">  <path d="M18 6 6 18"></path> <path d="m6 6 12 12"></path>  </svg> </span> </button> <!-- Mobile Menu Panel --> <div class="mobile-menu fixed inset-0 z-20 px-8 pt-20 bg-primary lg:hidden hidden opacity-0 scale-95 transform transition-all duration-200 ease-out overflow-y-auto"> <ul class="flex flex-col gap-4"> <li> <div class="text-headline-dark"> <div class="flex items-center justify-between"> <a href="/" class="py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-nav-mobile-text-active text-nav-mobile-text hover:text-nav-mobile-text-hover"> Home </a>  </div>  </div> </li><li> <div class="text-headline-dark"> <div class="flex items-center justify-between"> <a href="/bio" class="py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-nav-mobile-text-active text-nav-mobile-text hover:text-nav-mobile-text-hover"> About Greg </a>  </div>  </div> </li><li> <div class="text-headline-dark"> <div class="flex items-center justify-between"> <a href="https://procoder.myspreadshop.com" class="py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-nav-mobile-text-active text-nav-mobile-text hover:text-nav-mobile-text-hover"> Merch </a>  </div>  </div> </li> </ul> </div> </nav> </div> </div> <script type="module">const v=document.querySelectorAll(".group");v.forEach(s=>{const e=s.querySelector("a"),t=s.querySelector(".submenu"),n=t?.querySelectorAll("a");t&&e&&(s.addEventListener("mouseenter",()=>{l(t,e)}),s.addEventListener("mouseleave",()=>{i(t,e)}),e.addEventListener("keydown",c=>{c.key==="ArrowDown"&&s.children&&(c.preventDefault(),l(t,e),n?.[0]?.focus())}),e.addEventListener("focus",()=>{i(t,e)}),n?.forEach((c,a)=>{c.addEventListener("keydown",d=>{const m=n.length-1;switch(d.key){case"ArrowDown":d.preventDefault(),a<m&&n[a+1].focus();break;case"ArrowUp":d.preventDefault(),a>0?n[a-1].focus():(e.focus(),i(t,e));break;case"Escape":d.preventDefault(),i(t,e),e.focus();break;case"Tab":i(t,e);break}})}),document.addEventListener("focusin",c=>{s&&!s.contains(c.target)&&i(t,e)}))});function l(s,e){s.classList.remove("invisible","opacity-0"),s.classList.add("visible","opacity-100"),e.setAttribute("aria-expanded","true")}function i(s,e){s.classList.add("invisible","opacity-0"),s.classList.remove("visible","opacity-100"),e.setAttribute("aria-expanded","false")}document.querySelectorAll(".mobile-submenu-button").forEach(s=>{s.addEventListener("click",()=>{const e=s.parentElement?.nextElementSibling,t=s.querySelector("svg");if(e){e.classList.toggle("hidden"),t?.classList.toggle("rotate-180");const n=e.classList.contains("hidden")?"false":"true";s.setAttribute("aria-expanded",n)}})});const f=document.querySelector(".mobile-menu-button"),o=document.querySelector(".mobile-menu"),r=document.querySelector(".menu-icon"),u=document.querySelector(".close-icon");f?.addEventListener("click",()=>{o?.classList.contains("hidden")?(document.body.style.overflow="hidden",o?.classList.remove("hidden"),requestAnimationFrame(()=>{o?.classList.remove("opacity-0","scale-95"),o?.classList.add("opacity-100","scale-100")}),r?.classList.add("hidden"),u?.classList.remove("hidden")):(document.body.style.overflow="",o?.classList.add("opacity-0","scale-95"),o?.classList.remove("opacity-100","scale-100"),setTimeout(()=>{o?.classList.add("hidden")},200),r?.classList.remove("hidden"),u?.classList.add("hidden"))});</script> </header>  <div class="w-full h-120 absolute top-0 left-0 z-0 overflow-hidden border-b border-black">  <img src="/_astro/1_zrjjtCTZQSbnZXiMSrHJng.On3C6N9Z_Z253gRk.webp" alt width="1920" height="1080" loading="lazy" decoding="async" class="w-full h-full object-cover grayscale opacity-20"> <div class="absolute inset-0 bg-primary/10 backdrop-blur-md"></div>  </div> <article class="site-container--small mx-auto px-4 prose relative z-10 pb-base"> <div class="mt-42 mb-12 text-center"> <h1>How I stopped worrying and learned to love regular expressions</h1> <div class="flex items-center justify-center gap-4 text-gray-600"> <time datetime="2022-06-08T00:00:00.000Z" class="text-sm text-body-base"> June 8th, 2022 </time> <div class="flex flex-wrap gap-2"> <span class="px-2 py-1 text-sm rounded-sm bg-primary/10 text-primary border-primary border flex items-center justify-center leading-none font-medium"> Imported from Medium </span> </div> </div> </div> <img src="/_astro/1_zrjjtCTZQSbnZXiMSrHJng.On3C6N9Z_zNDum.webp" alt width="1200" height="675" loading="lazy" decoding="async" class="w-full h-auto rounded-lg border mb-12 border-black"> <div class="mt-8"> <h1 id="how-i-stopped-worrying-and-learned-to-love-regular-expressions">How I stopped worrying and learned to love regular expressions</h1>
<p>As mentioned in my previous article, people select relational over NoSQL databases for new projects. Big time. We’re talking 80% of the…</p>
<hr>
<h3 id="how-i-stopped-worrying-and-learned-to-love-regular-expressions-1">How I stopped worrying and learned to love regular expressions</h3>
<p><a href="/articles/medium/2022-06-01_writing-tests-is-never-a-mistake--78d7054f56ba">As mentioned in my previous article</a>, people select relational over NoSQL databases for new projects. Big time. We’re talking 80% of the time. That’s 4-to-1 for you odds makers. And because no app is truly complete without data, it makes Spring Data JPA rank VERY high in most-selected modules when people pull together a new app over at <a href="https://start.spring.io">https://start.spring.io</a>.</p>
<p><img  width="800" height="800" loading="lazy" decoding="async" src="/_astro/1_zrjjtCTZQSbnZXiMSrHJng.On3C6N9Z_ZS21D2.webp" >Seriously, when someone wants to whip up and app and they use that wickedly cool website, they most often reach for Spring Boot (cuz its baked in), Spring Security (your app isn’t real until its secured) and Spring Data JPA.</p>
<p>And what happens when you’re popular? People open tickets against the project. We’re talking on a daily basis. And someone was needing to use PostgreSQL’s JSONB functions.</p>
<p>This ain’t your grandpa’s relational database.</p>
<p>No, today all the cool kids are using hot features like JSON-manipulating functions rolled straight into their SQL code. In this case, PostgreSQL has support parsing and gleaning JSON. And this includes some slick operators. Look at this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'{"a":1, "b":2}'::jsonb ? 'b'</span></span></code></pre>
<p>That little puppy will query a JSON structure to test whether or not HAS “b” as a key in the structure. Nice, ehh? Probably better than pulling out some string-based data, running it through a JSON parser, and THEN querying for something.</p>
<p>Why NOT put that RIGHT INTO THE DATABASE?</p>
<p>Did I mentioned Spring Data JPA earlier in this article? Spring Data JPA doesn’t do JPA directly. No, we offload actual JPA operations to a JPA provider, whether thats Hibernate or EclipseLink. But we provide some handy integrations.</p>
<p>For example, if you declare an interface method, we can glean the nature of the entity type, parse the method name, and essentially talk to the JPA entity manager on your behalf to assemble a query. If you’ve worked with the EntityManager SPI directly, then you’ll understand why this is really slick for something like 80% of standard queries.</p>
<p>We also provide some other ways to take domain-level knowledge of your application and transform it into JPA styled queries.</p>
<p>But if there’s one thing Spring does, it’s provide you with an escape hatch. Maybe your query is flat out too complicated for our easements. In that situation, you can simply apply an @Query annotation to your query method and roll the JPQL yourself!</p>
<p>Which has proven to be quite handy for your Spring Data community.</p>
<p>Unless you happen to be using one of these new-fangled JSON operators! Something we try and guard against is people mixing what are called “JDBC style parameters” (?) with “JPA style parameters” (:foo or ?2). When you fashion a query, you really need to pick one or the other.</p>
<p>The error message from the JPA provider may be cryptic, so we try to catch that early on. Well guess what this type of query would look like:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>@Query("SELECT * FROM table WHERE (json_col->'jsonKey')::jsonb \\?\\? :param ")  </span></span>
<span class="line"><span>List&#x3C;User> customQueryWithQuestionMarksAndNamedParam(String param);</span></span></code></pre>
<p>Hibernate will allow a double question mark (??) through, turning it into a single question mark (?) on the other side. I’m not sure if JPA itself covers this, or if this is outside the spec.</p>
<p>But either way, our existing pattern detectors viewed this as a JDBC-style parameter. And the named (:param) argument is deemed JPA-style. And thus, this query was viewed as a mixer, which meant we shut it down as BAD!</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Mixing of ? parameters and other forms like ?1 is not supported!</span></span></code></pre>
<p>So I spent probably 2–3 hours today simply grokking the problem at hand. I fashioned a test case to sniff out that double-? and ignore it, but realized we needed much more comprehensive testing.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>@Query("SELECT * FROM table WHERE (json_col->'jsonKey')::jsonb \\?\\? :param ")  </span></span>
<span class="line"><span>List&#x3C;User> customQueryWithQuestionMarksAndNamedParam(String param);</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>@Query("SELECT * FROM table WHERE (json_col->'jsonKey')::jsonb \\?\\? ? ")  </span></span>
<span class="line"><span>List&#x3C;User> customQueryWithQuestionMarksAndJdbcStyleParam(String param);</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>@Query("SELECT * FROM table WHERE (json_col->'jsonKey')::jsonb \\?\\? ?1 ")  </span></span>
<span class="line"><span>List&#x3C;User> customQueryWithQuestionMarksAndNumberedStyleParam(String param);</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>@Query("SELECT * FROM table WHERE (json_col->'jsonKey')::jsonb \\?\\? ?1 and other_col = ? ")  </span></span>
<span class="line"><span>List&#x3C;User> customQueryWithQuestionMarksAndJdbcStyleAndNumberedStyleParam(String param1, String param2);</span></span></code></pre>
<p>Essentially, we need laser-focused resolution on what’s happening so only legit queries are allowed through. And sometime, when solving a problem, you need to watch out for the edge cases right next door to your current scenario. I didn’t want to solve this problem and have a nigh-identical ticket get opened the next day.</p>
<p>And so I ended up, knee deep in Spring Data JPA code, writing a regex pattern detector for JDBC-style (?), numbered-style (?1), and named-style (:foo) parameters.</p>
<p>If there is something that makes any coder squirm and shake, it’s maintaining regex patterns. Well, I’ve done them for years. PERL, Python, and even the scary Java variants. And I knew, KNEW, that what we needed in this scenario was something called a “zero width lookahead” pattern.</p>
<p>Basically ask the question “does this string contain a space, following by a question mark, and NOT followed by a number”. Spoiler alert: it looks like this…</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Pattern JDBC_STYLE_PARAM = Pattern.compile(" \\?(?!\\d)");</span></span></code></pre>
<p>That pattern starts with a space. It then has the question mark. And to avoid this being an “optional” modifier, has a backslash in front of it. (And a 2nd backslash to escape the backslash. Welcome to Java pattern matching.)</p>
<p>That last pattern is extra complex, so I’ll pull it down below first:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>(?!\d)</span></span></code></pre>
<p>Wrapped with parentheses, the first character is a ?, indicating it’s a lookahead or lookbehind pattern. The !-character signals this as a negative match, i.e. a NOT. And \d signals that we’re looking for a digit.</p>
<p>So this little thing means to look head, and see if there is NOT a digit, without consuming any characters. (That’s what zero lookahead means).</p>
<p>The alternative way to write “…and not followed by zzz” is so convoluted I’m not even putting it here. This little pattern lets you find a question mark NOT followed a digit.</p>
<p>And I didn’t know this before today. Or better stated, someone ELSE submitted a patch to Spring Data JPA a few weeks ago using the same construct but on another pattern. And this was the first time I realized THAT was the solution I needed! And reached for it today.</p>
<p>And it worked beautifully.</p>
<p>I’ll let you read the following pattern and deduce what each of them does:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Pattern NUMBERED_STYLE_PARAM = Pattern.compile(" \\?(?=\\d)");  </span></span>
<span class="line"><span>Pattern NAMED_STYLE_PARAM = Pattern.compile(" :\\w+");</span></span></code></pre>
<p>HINT: In look aheads, = is the match, and ! is the NOT match. To look behind, you use ?&#x3C;.</p>
<p>JPA parameters are basically numbered OR named. Using these handy little patterns made it possible for me to rewrite our handlers. After all, we only want to sniff out someone using JPA and JDBC in the same query. Anything else, and we turn it over to the JPA provider and then let them pass it on to the database engine.</p>
<p>If the engine itself doesn’t handle JSONB queries, well that’s between you and your database engine.</p>
<p>Stay tuned for my next article. However, if you simply can’t wait, then check out the video below and get a taste of querying for data with Spring Boot!</p>
<p>— Greg</p>
<p><em>Do you want to get a free tech e-book, be alerted to my discounts, and get even MORE content about SPRING BOOT? Then</em> <a href="https://trnq.st/d2v5"><em>SIGN UP FOR MY NEWSLETTER</em></a><em>.</em></p> </div> <h6>
Originally published as <i><a rel="canonical" target="_blank" href="https://medium.com/@procoderio/how-i-stopped-worrying-and-learned-to-love-regular-expressions-40fd12400bf0">How I stopped worrying and learned to love regular expressions</a></i> </h6> </article>   <footer class="bg-background-dark text-body-dark text-small pb-small pt-4"> <div class="site-container mx-auto px-4"> <div class="flex flex-col items-center md:items-start md:flex-row md:justify-between pb-8 border-b border-background-light"> <nav class="flex flex-row justify-center md:justify-start gap-4 md:gap-8"> <div> <a href="/" class="text-small font-medium text-body-dark uppercase focus:outline-none focus:ring-2 focus:ring-nav-text-active transition-colors text-nav-text hover:text-nav-text-hover"> Home </a> </div><div> <a href="/whitelist-instructions" class="text-small font-medium text-body-dark uppercase focus:outline-none focus:ring-2 focus:ring-nav-text-active transition-colors text-nav-text hover:text-nav-text-hover"> Whitelist Instructions </a> </div> </nav> </div> <div class="mt-8 flex flex-col md:flex-row justify-between items-center"> <div class="text-sm text-secondary"> <p class="mt-4">Actionable Advice to Advance Your Career</p>
© 2025 Greg L. Turnquist. All rights reserved.
</div> <nav class="mt-4 md:mt-0"> <ul class="flex flex-wrap gap-6"> <li> <a href="/legal/privacy-policy" class="text-sm text-secondary"> Privacy Policy </a> </li><li> <a href="/legal/terms-of-service" class="text-sm text-secondary"> Terms of Service </a> </li> </ul> </nav> </div> </div> </footer> <!--<ThemeSwitcher />--> <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.DLBBgGU8.js"></script> </body> </html>