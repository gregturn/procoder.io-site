<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/favicon-180x180.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/xml; charset=utf-8" x-content-type="nosniff" title="Pro Coder" href="https://dev.procoder.io/rss.xml"><link rel="canonical" href="https://dev.procoder.io/articles/2023/2023-10-07_don-t-be-afraid-to-take-a-shot--70e6c3cb80d0/"><meta name="generator" content="Astro v5.7.9"><title>Don’t be afraid to take a shot! | Pro Coder</title><!-- Google tag (gtag.js) @formatter:off --><script async src="https://www.googletagmanager.com/gtag/js?id=G-8W1YK6K7NM"></script> <script type="module">const a={measurementId:"G-8W1YK6K7NM"};window.dataLayer=window.dataLayer||[];window.gtag=function(){dataLayer.push(arguments)};window.gtag("js",new Date);window.gtag("config",a.measurementId);</script> <!-- Google tag (gtag.js) @formatter:on --><meta name="description" content="A couple weeks ago, I pinged our fearless leader. I needed some direction before taking on a couple tasks. One of these tasks I was…"><meta name="robots" content="index, follow"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"><!-- Open Graph --><meta property="og:type" content="website"><meta property="og:url" content="https://dev.procoder.io/articles/2023/2023-10-07_don-t-be-afraid-to-take-a-shot--70e6c3cb80d0/"><meta property="og:title" content="Don’t be afraid to take a shot! | Pro Coder"><meta property="og:description" content="A couple weeks ago, I pinged our fearless leader. I needed some direction before taking on a couple tasks. One of these tasks I was…"><meta property="og:image" content="https://dev.procoder.io/_astro/1_rsWLmOIE9cRFhtGIvMjFUg.BlLEZdjo.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://dev.procoder.io/articles/2023/2023-10-07_don-t-be-afraid-to-take-a-shot--70e6c3cb80d0/"><meta property="twitter:title" content="Don’t be afraid to take a shot! | Pro Coder"><meta property="twitter:description" content="A couple weeks ago, I pinged our fearless leader. I needed some direction before taking on a couple tasks. One of these tasks I was…"><meta property="twitter:image" content="https://dev.procoder.io/_astro/1_rsWLmOIE9cRFhtGIvMjFUg.BlLEZdjo.png"><link rel="stylesheet" href="/_astro/_page_.DdVErAXE.css"></head> <body data-theme="procoder"> <header class="fixed top-0 z-50 w-full left-0"> <div class="site-container mx-auto px-4 mt-4"> <div class="flex justify-between items-center gap-4 bg-primary/90 py-2 lg:py-4 rounded-lg px-4 border-black border"> <a href="/" class="logo uppercase font-logo transition-colors duration-200 font-light text-header-logo hover:text-primary">  <img src="/_astro/ProCoderLogo_white.DI51sbMv_Z1hejQB.webp" alt width="1800" height="1800" loading="lazy" decoding="async" class="w-16 h-auto">  </a> <nav class="relative flex items-center gap-2 lg:gap-8" aria-label="Site Navigation"> <!-- Desktop Menu --> <ul class="hidden lg:flex lg:gap-8 items-center"> <li class="relative group"> <div class="flex items-center gap-1"> <a href="/" class="text-small font-medium uppercase rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-nav-text-active text-nav-text hover:text-nav-text-hover"> Home  </a> </div>  </li><li class="relative group"> <div class="flex items-center gap-1"> <a href="/bio" class="text-small font-medium uppercase rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-nav-text-active text-nav-text hover:text-nav-text-hover"> About Greg  </a> </div>  </li><li class="relative group"> <div class="flex items-center gap-1"> <a href="https://procoder.myspreadshop.com" class="text-small font-medium uppercase rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-nav-text-active text-nav-text hover:text-nav-text-hover" target="_blank"> Merch  </a> </div>  </li> </ul> <!-- CartButton is after desktop menus, but before the hamburger icon --> <a href="/checkout" class="flex items-center gap-2 text-background px-4 py-2 transition " id="cart-button"> <div class="relative text-secondary"> <svg xmlns="http://www.w3.org/2000/svg" stroke-width="2" width="28" height="28" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" fill="none" viewBox="0 0 24 24" class="lucide lucide-shopping-cart">  <circle cx="8" cy="21" r="1"></circle> <circle cx="19" cy="21" r="1"></circle> <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>  </svg> <span id="cart-count" class="absolute top-[-5px] right-[-10px] bg-secondary text-background-dark text-xs rounded-full w-5 h-5 flex items-center justify-center">
0
</span> </div> <script type="module" src="/_astro/CartButton.astro_astro_type_script_index_0_lang.nsIViABD.js"></script> </a> <!-- Mobile Menu Button --> <button class="mobile-menu-button relative z-30 p-2 border-none cursor-pointer bg-transparent lg:hidden" aria-label="Toggle Menu" aria-expanded="false"> <span class="menu-icon block"> <svg xmlns="http://www.w3.org/2000/svg" stroke-width="2" width="24" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" fill="none" viewBox="0 0 24 24" class="lucide lucide-menu text-nav-mobile-text">  <line x1="4" x2="20" y1="12" y2="12"></line> <line x1="4" x2="20" y1="6" y2="6"></line> <line x1="4" x2="20" y1="18" y2="18"></line>  </svg> </span> <span class="close-icon hidden"> <svg xmlns="http://www.w3.org/2000/svg" stroke-width="2" width="24" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" fill="none" viewBox="0 0 24 24" class="lucide lucide-x text-nav-mobile-text">  <path d="M18 6 6 18"></path> <path d="m6 6 12 12"></path>  </svg> </span> </button> <!-- Mobile Menu Panel --> <div class="mobile-menu fixed inset-0 z-20 px-8 pt-20 bg-primary lg:hidden hidden opacity-0 scale-95 transform transition-all duration-200 ease-out overflow-y-auto"> <ul class="flex flex-col gap-4"> <li> <div class="text-headline-dark"> <div class="flex items-center justify-between"> <a href="/" class="py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-nav-mobile-text-active text-nav-mobile-text hover:text-nav-mobile-text-hover"> Home </a>  </div>  </div> </li><li> <div class="text-headline-dark"> <div class="flex items-center justify-between"> <a href="/bio" class="py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-nav-mobile-text-active text-nav-mobile-text hover:text-nav-mobile-text-hover"> About Greg </a>  </div>  </div> </li><li> <div class="text-headline-dark"> <div class="flex items-center justify-between"> <a href="https://procoder.myspreadshop.com" class="py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-nav-mobile-text-active text-nav-mobile-text hover:text-nav-mobile-text-hover"> Merch </a>  </div>  </div> </li> </ul> </div> </nav> </div> </div> <script type="module">const v=document.querySelectorAll(".group");v.forEach(s=>{const e=s.querySelector("a"),t=s.querySelector(".submenu"),n=t?.querySelectorAll("a");t&&e&&(s.addEventListener("mouseenter",()=>{l(t,e)}),s.addEventListener("mouseleave",()=>{i(t,e)}),e.addEventListener("keydown",c=>{c.key==="ArrowDown"&&s.children&&(c.preventDefault(),l(t,e),n?.[0]?.focus())}),e.addEventListener("focus",()=>{i(t,e)}),n?.forEach((c,a)=>{c.addEventListener("keydown",d=>{const m=n.length-1;switch(d.key){case"ArrowDown":d.preventDefault(),a<m&&n[a+1].focus();break;case"ArrowUp":d.preventDefault(),a>0?n[a-1].focus():(e.focus(),i(t,e));break;case"Escape":d.preventDefault(),i(t,e),e.focus();break;case"Tab":i(t,e);break}})}),document.addEventListener("focusin",c=>{s&&!s.contains(c.target)&&i(t,e)}))});function l(s,e){s.classList.remove("invisible","opacity-0"),s.classList.add("visible","opacity-100"),e.setAttribute("aria-expanded","true")}function i(s,e){s.classList.add("invisible","opacity-0"),s.classList.remove("visible","opacity-100"),e.setAttribute("aria-expanded","false")}document.querySelectorAll(".mobile-submenu-button").forEach(s=>{s.addEventListener("click",()=>{const e=s.parentElement?.nextElementSibling,t=s.querySelector("svg");if(e){e.classList.toggle("hidden"),t?.classList.toggle("rotate-180");const n=e.classList.contains("hidden")?"false":"true";s.setAttribute("aria-expanded",n)}})});const f=document.querySelector(".mobile-menu-button"),o=document.querySelector(".mobile-menu"),r=document.querySelector(".menu-icon"),u=document.querySelector(".close-icon");f?.addEventListener("click",()=>{o?.classList.contains("hidden")?(document.body.style.overflow="hidden",o?.classList.remove("hidden"),requestAnimationFrame(()=>{o?.classList.remove("opacity-0","scale-95"),o?.classList.add("opacity-100","scale-100")}),r?.classList.add("hidden"),u?.classList.remove("hidden")):(document.body.style.overflow="",o?.classList.add("opacity-0","scale-95"),o?.classList.remove("opacity-100","scale-100"),setTimeout(()=>{o?.classList.add("hidden")},200),r?.classList.remove("hidden"),u?.classList.add("hidden"))});</script> </header>  <div class="w-full h-120 absolute top-0 left-0 z-0 overflow-hidden border-b border-black">  <img src="/_astro/1_rsWLmOIE9cRFhtGIvMjFUg.BlLEZdjo_Z1sxvFH.webp" alt width="1920" height="1080" loading="lazy" decoding="async" class="w-full h-full object-cover grayscale opacity-20"> <div class="absolute inset-0 bg-primary/10 backdrop-blur-md"></div>  </div> <article class="site-container--small mx-auto px-4 prose relative z-10 pb-base"> <div class="mt-42 mb-12 text-center"> <h1>Don’t be afraid to take a shot!</h1> <div class="flex items-center justify-center gap-4 text-gray-600"> <time datetime="2023-10-07T00:00:00.000Z" class="text-sm text-body-base"> October 7th, 2023 </time> <div class="flex flex-wrap gap-2"> <span class="px-2 py-1 text-sm rounded-sm bg-primary/10 text-primary border-primary border flex items-center justify-center leading-none font-medium"> Imported from Medium </span> </div> </div> </div> <img src="/_astro/1_rsWLmOIE9cRFhtGIvMjFUg.BlLEZdjo_7MS73.webp" alt width="1200" height="675" loading="lazy" decoding="async" class="w-full h-auto rounded-lg border mb-12 border-black"> <div class="mt-8"> <h1 id="dont-be-afraid-to-take-a-shot">Don’t be afraid to take a shot!</h1>
<p>A couple weeks ago, I pinged our fearless leader. I needed some direction before taking on a couple tasks. One of these tasks I was…</p>
<hr>
<h3 id="dont-be-afraid-to-take-ashot">Don’t be afraid to take a shot!</h3>
<p>A couple weeks ago, I pinged our fearless leader. I needed some direction before taking on a couple tasks. One of these tasks I was thinking about, which seemed tiny at the time, I joked “for THAT one, perhaps I should write a parser?”</p>
<p>He rolled his eyes. “We don’t need a parser.”</p>
<p>Two weeks later…</p>
<p><img  width="800" height="425" loading="lazy" decoding="async" src="/_astro/1_rsWLmOIE9cRFhtGIvMjFUg.BlLEZdjo_Z1Y3ekx.webp" >Spring Data JPA has a handy feature where you can dynamically feed it <strong>ORDER BY</strong> clauses with simple strings, e.g. <strong>Sort.by(“firstname”)</strong>. This nicely gets turned into a JPA Criteria <strong>Expression</strong> object.</p>
<p>In the simplest of cases, this is an entity type’s property name. However, we have always offered this escape hatch where you can feed it ANYTHING. For example, you could feed it <strong>LENGTH(firstname)</strong> as your criteria to apply an <strong>ORDER BY</strong> to a query, where you order things not by the row’s <strong>firstname</strong> but instead by the length of the row’s <strong>firstname</strong>. Basically, anything that your JPA provider supports.</p>
<p>In my pre-op analysis, I uncovered a seemingly endless supply of hacks and workarounds on StackOverflow.com. I was beginning to think that this feature NEVER worked!</p>
<p><img  width="800" height="656" loading="lazy" decoding="async" src="/_astro/1_bjE44xN1CuLz3491ZCllDA.B_rN_9G2_Z1Fp9nw.webp" >Quite naturally, as a test-bitten script junky, my first step was to write a test case. <strong>LENGTH(firstname)</strong> seemed like the textbook scenario that perfectly captured the situation while being easy to reason over.</p>
<p><img  width="800" height="186" loading="lazy" decoding="async" src="/_astro/1_r9VfRzW_xHLNDa2sOIDt1w.B822X26l_Zcudky.webp" >Right there, in the middle, you can see <strong>LENGTH(firstname)</strong> nestled in the midst of <strong>JpaSort.unsafe()</strong>. To be clear, this query essentially says “find all objects and order them not by their <strong>firstname</strong>, but instead by the <strong>length</strong> of their <strong>firstname</strong>. (This query also has a paging argument, which I won’t delve into).</p>
<p>With this tasty string value at my finger tips, I cracked open JPA’s <strong>CriteriaBuilder</strong> interface and began scouring it, looking for the place where you feed it a string like that and get handed back an <strong>Expression</strong>.</p>
<p>There was none to be found.</p>
<p>You see, if you have a simple entity property like <strong>firstname</strong>, then you can submit a <strong>from.get(“firstname”)</strong> call. The from object is the root entity (<strong>User</strong> in this test scenario). <strong>from.get(“firstname”)</strong> is turned by the Criteria API into <strong>ORDER BY User.firstname</strong>.</p>
<p>But any sort of “parse this string” doesn’t exist!</p>
<p>My eyebrows narrowed. Having tamed the beast of HQL a few months ago with the power of ANTLR, my thoughts of writing some type of parser rapidly shifted from humor toward seriousness.</p>
<p>And then a lightbulb went off.</p>
<p>I didn’t have to write a parser. I already HAD a parser! The HQL one I had written months ago. You see in ANTLR, there is no requirement that you enter a parser at the “top”. That’s only required if you are parsing an entire query.</p>
<p>In this scenario, I only want to parse from the <strong>ORDER BY</strong> clause, which for HQL is the <strong>sortExpression</strong>.</p>
<p><img  width="456" height="298" loading="lazy" decoding="async" src="/_astro/1_VHY0ImgbquuSC3K12JMnxA.DX8HoWgf_Z5bbWE.webp" >In HQL parsing, it’s technically <strong>ORDER BY sortedItem</strong>, which <strong>sortedItem</strong> including things like <strong>ASC</strong> and <strong>DESC</strong>. However, our <strong>JpaSort</strong> already takes on aspects like direction, so I must enter one level deeper, the <strong>sortExpression</strong>.</p>
<p>And thus a method was drafted!</p>
<p><img  width="800" height="346" loading="lazy" decoding="async" src="/_astro/1_KdSNLmKgClgUj3SV_JW0KA.6w1Ld1EG_Z1zLhhu.webp" >This is standard entry into ANTLR. You craft an HQL lexer to turn the string value of the JpaSort’s property value into a series of tokens. You then feed that stream of tokens into an HQL-based parser, and finally “visit” it by invoking the sortExpression() method in the ANTLR-generated class.</p>
<p>Hanging this inside a newly minted <strong>HqlOrderByExtractor</strong> class, with copies of JPA’s <strong>CriterialBuilder</strong> and <strong>From</strong>, I was ready to begin.</p>
<p>But WHAT was I ready to begin doing?</p>
<p>Simply put, I was going to write a brand new ANTLR visitor!</p>
<p>ANTLR has two ways to walk through a parsed structure. The visitor pattern is the only one that gives you one method to handle entering and exiting a given token, hence this was it.</p>
<p>The previous ANTLR visitor I wrote for fully parsing an entire HQL query is based upon transforming one string into another. That’s not what we’re doing here. Instead, the mission here is to transform an <strong>ORDER BY</strong> clause into a Criteria API <strong>Expression</strong>.</p>
<p>And away I flew! It turned out to not be that hard to capture our leading example of <strong>LENGTH(firstname)</strong> and turn it into an <strong>Expression</strong>. The code itself may appear tedious to those unfamiliar with ANTLR’s visitor paradigm, but for me, this was old hat.</p>
<p>I had that function working within a day. The question shifted to what OTHER expressions did HQL support?</p>
<p>A. Lot.</p>
<p>The screenshot below is but a sliver of the test cases I wrote.</p>
<p><img  width="800" height="299" loading="lazy" decoding="async" src="/_astro/1_j_aj8YNqIZZ0b20jjip8JA.Dk0CHEcr_Z1wk3VI.webp" >You can really write an HQL query with <strong>ORDER BY CASE firstname WHEN ‘Oliver’ then ‘A’ ELSE firstname end</strong>, where if the <strong>firstname</strong> matches <strong>Oliver</strong>, it will swap in the value <strong>A</strong>, and otherwise it will simply use the row’s <strong>firstname</strong>, all for the purposes of ordering the data.</p>
<p>Once I captured all these scenarios and implemented them, I moved on to coding support for JPQL (Java Persistence Query Language) as well EQL (EclipseLink Query Language).</p>
<p>In the interests of bringing this article back to this world, suffice it to say, I spent another four days writing tests and implementing them. I even wrote some special test utilities that helped me “hide” Hibernate as well as EclipseLink from some of our classpath checks, making it a snap to verify our supported JPA providers.</p>
<p>After almost entire day spent simply polishing my changes, renaming things, and writing suitable comments, I submitted a pull request to our team leader. He happened to be on PTO the week I did all this work.</p>
<p>And perhaps that’s a good thing.</p>
<p>His absence provoked me to take this shot and implement support for a feature that looks as if it may NEVER have worked. And I’m quite proud of being able to leverage the knowledge I attained in building our HQL parser in the first place.</p>
<p>And I hope this provokes <em>you</em> to consider taking a shot on something that may at first sound like a lark, but could be the turning point in a system you are working on.</p>
<p>To be a pro coder, you sometimes have to take that shot.</p>
<p>Not a reckless gamble, but instead a fair minded attempt at something that may take more than a day to even figure out if it’s plausible. But an attempt that if successful, may be a turning point in the system you’re working on.</p>
<p>Because that’s one of the defining differences between a hobbyist and a pro coder. Pro coders implement things that aren’t always the easiest nor straight forward. But sometimes because we have little more than a hint that this may be the right thing to do.</p>
<p>If you are pro coder or aiming to become one, then stay tuned for my next article. But if you simply can’t wait, then check out this video below where Josh Long and I shoot the breeze over Spring Data during SpringOne @ VMware Explore in 2023.</p>
<p>— Greg</p>
<p><em>Do you want to get a free tech e-book, be alerted to my discounts, and get even MORE content about PRO CODING? Then</em> <a href="https://trnq.st/d2v5"><em>SIGN UP FOR MY NEWSLETTER</em></a><em>.</em></p> </div>  <h6 class="py-6">
Originally published as <i><a rel="canonical" target="_blank" href="https://medium.com/@procoderio/dont-be-afraid-to-take-a-shot-70e6c3cb80d0">Don’t be afraid to take a shot!</a></i> </h6> </article>   <footer class="bg-background-dark text-body-dark text-small pb-small pt-4"> <div class="site-container mx-auto px-4"> <div class="flex flex-col items-center md:items-start md:flex-row md:justify-between pb-8 border-b border-background-light"> <nav class="flex flex-row justify-center md:justify-start gap-4 md:gap-8"> <div> <a href="/" class="text-small font-medium text-body-dark uppercase focus:outline-none focus:ring-2 focus:ring-nav-text-active transition-colors text-nav-text hover:text-nav-text-hover"> Home </a> </div><div> <a href="/whitelist-instructions" class="text-small font-medium text-body-dark uppercase focus:outline-none focus:ring-2 focus:ring-nav-text-active transition-colors text-nav-text hover:text-nav-text-hover"> Whitelist Instructions </a> </div> </nav> </div> <div class="mt-8 flex flex-col md:flex-row justify-between items-center"> <div class="text-sm text-secondary"> <p class="mt-4">Actionable Advice to Advance Your Career</p>
© 2025 Greg L. Turnquist. All rights reserved.
</div> <nav class="mt-4 md:mt-0"> <ul class="flex flex-wrap gap-6"> <li> <a href="/legal/privacy-policy" class="text-sm text-secondary"> Privacy Policy </a> </li><li> <a href="/legal/terms-of-service" class="text-sm text-secondary"> Terms of Service </a> </li> </ul> </nav> </div> </div> </footer> <!--<ThemeSwitcher />--> <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.DLBBgGU8.js"></script> </body> </html>